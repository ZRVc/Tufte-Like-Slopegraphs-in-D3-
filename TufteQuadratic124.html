<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Tufte Bembo Style</title>
</head>

<style>
@font-face {
    font-family: "et-book-roman-old-style";
    src: url("https://zrvc.github.io/Tufte-Like-Slopegraphs-in-D3-/et-book/et-book-roman-old-style-figures.eot");
    src: url("et-book/et-book-roman-old-style-figures.eot?#iefix") format("embedded-opentype"), url("et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff") format("woff"), url("et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf") format("truetype"), url("et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf") format("svg");
    font-weight: normal;
    font-style: normal; 
}
body {
  font-family: et-book-roman-old-style, Palatino Linotype, serif;
font-size: 11pt;
font-variant-numeric: oldstyle-nums;
}
</style>



<body>
  <svg width="1500" height="5000">
      <g class="nums" transform="translate(180, 120)">
      </g>
  </svg>

  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script>
    
	var displaydigits = 1;
	
	var textcolor = "black";
	var linecolor = "#b6b6b6";
	
	var highlight = [];
	var highlighttextcolor = "red";
	var highlightlinecolor = "green";

	var colspace = 200;
    var linehspace = 12;
    var linevspace = -0;
    var rowlabelspace = 38;
    var collabelspace = -42;
	
	var bookversion = 0;

	
d3.csv("https://raw.githubusercontent.com/ZRVc/Tufte-Style-Slopegraphs-in-D3-/master/TufteGovernment.csv")
    .then(function(data){
        
  
        data.forEach(function(d) {
        for (var key in d) {
        if (+d[key]===+d[key]) {
            d[key] = +d[key];
        }
    }
    });
    
    var keys = d3.keys(data[0]);
    var nrow = data.length;
    var nums = d3.select("svg .nums")
        .selectAll("text");
    
    
        var headers = nums.data(keys)
                .enter()
                .append("text")
                .attr("x", function(d, i) {
                                if (i === 0) {
                                return i*colspace;} else {
                                return (i-1)*colspace+rowlabelspace;
                                }
                })
                .attr("y", function(d, i) {
                    return collabelspace;
                })
                .text(function(d, i) {
				if (i === 0) {
				return "";} else {
                    return keys[i];
				}
                })
                .style("text-anchor", function(d, i) {
                                if (i === 1) {
                                return "end";} else {
								return "start";}
                    })
				.style("font-size", "12pt")
				.style("fill", d3.rgb(textcolor))
            ;
    
//These points were gotten from the Rscript:
	var v1 = [250.16, 317.78, 333.78, 400.03, 429.94, 485.77, 531.71, 515.71, 547.71, 643.69, 659.69, 728.62, 744.62, 834.33, 881.31];
	var v2 = [0, 36.65, 126.51, 440.53, 325.11, 357.11, 341.11, 501.42, 469.09, 517.42, 607.27, 638.09, 585, 724.74, 740.74];
	
//Paste the line endpoints here if drawing Tufte's book version:	
	if (bookversion > 0) {
	var l1 = [234.71, 302.52, 318.52, 392.65, 408.65, 464.51, 505.12, 521.12, 537.12, 642.19, 658.19, 718.36, 734.36, 823.7, 868.77];
	var l2 = [0, 38.75, 124.04, 430.65, 310.3, 343.8, 326.3, 507.71, 463.36, 523.71, 609.01, 633.42, 584.6, 720.88, 736.88];
	} else {
	var l1 = v1;
	var l2 = v2;
	}
	
	function Colorfill(textcolor,linecolor,highlighttextcolor,highlightlinecolor,times,highlight) {
	var arr = [];
	for (var i = 0; i < times; i++) {
	if (highlight.includes((i+1))) {
	arr.push([highlighttextcolor,highlighttextcolor,highlightlinecolor,highlighttextcolor,highlighttextcolor]);
	} else {
	arr.push([textcolor,textcolor,linecolor,textcolor,textcolor]);
	}
	}
	 return arr;
	 }
	
	var col = Colorfill(textcolor,linecolor,highlighttextcolor,highlightlinecolor,v1.length,highlight)
     
    for (j = 0; j < v1.length; j++) {
    
    var wNew = [d3.values(data[j])[0], d3.values(data[j])[1], d3.values(data[j])[2], d3.values(data[j])[0]];
    var vNew = [v1[j], v1[j], v2[j], v2[j]];
    var lNew = [l1[j], l1[j], l2[j], l2[j]];
	var colTNew = [col[j][0], col[j][1], col[j][3], col[j][4]];
	var colLNew = col[j][2];
    
        nums.data(wNew)
            .enter()
            .append("text")
            .attr("x", function(d, i) {
                                if (i === 0) {
                                return 0} else if (i < 3) {
                                return (i-1)*colspace+rowlabelspace;
                                } else {return (i-2)*colspace+2*rowlabelspace;
				}
                })
            .attr("y", function(d, i) {
                    return vNew[i];            
                })
            .text(function(d, i) {
				if (i === 1 || i === 2) {
                return (Math.round(wNew[i] * (10^displaydigits)) / (10^displaydigits)).toFixed(displaydigits);
				} else { return wNew[i];
				}
            })
            .style("text-anchor", function(d, i) {
                                if (i < 2) {
                                return "end";} else {
								return "start";}
                    })
			.style("fill", function(d, i) {
			return (d3.rgb(colTNew[i]));
			})
            .attr("dominant-baseline", "middle")
            ;
            
			nums.data(lNew)
			.enter()
			.append('line')
			.style("stroke", function(d, i) {
			return (d3.rgb(colLNew));
			})
			.attr('stroke-width', 1)
			.attr('x1', function(d, i) {
								if (i > 0 && i < keys.length-1) {
								return (i-1)*colspace+rowlabelspace+linehspace;
								}
										})
			.attr('y1', function(d, i) {
								if (i > 0 && i < keys.length-1) {
								return lNew[i]+linevspace;
								}
										})
			.attr('x2', function(d, i) {
								if (i > 0 && i < keys.length-1) {
								return (i)*colspace+rowlabelspace-linehspace;
								}
										})
			.attr('y2', function(d, i) {
								if (i > 0 && i < keys.length-1) {
								return lNew[(i+1)]+linevspace;
								}
										});
                                    
}
})
            
  </script>
</body>
</html>
